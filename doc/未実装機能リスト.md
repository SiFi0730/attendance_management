# 未実装機能リスト

最終更新: 2025-01-26

## 📋 概要

本ドキュメントは、仕様書（`doc/仕様書.md`）に定義されている機能のうち、現在実装されていない機能を全てリストアップしたものです。

---

## ✅ 実装済み機能

### 1. データベース設計
- ✅ 全20テーブルのスキーマ定義
- ✅ Row-Level Security (RLS) ポリシー
- ✅ インデックス最適化
- ✅ トリガー（タイムスタンプ自動更新、循環参照防止）

### 2. 認証・認可システム
- ✅ ログイン機能 (`POST /auth/login`)
- ✅ ログアウト機能 (`POST /auth/logout`)
- ✅ 会員登録機能 (`POST /auth/register`)
- ✅ パスワードリセット要求 (`POST /auth/password-reset`)
- ✅ パスワードリセット実行 (`POST /auth/password-reset/verify`)
- ✅ 現在のユーザー情報取得 (`GET /auth/me`)
- ✅ セッション管理（PHPセッション）
- ✅ 認証ミドルウェア
- ✅ テナント解決ミドルウェア

### 3. テナント管理
- ✅ テナント一覧取得 (`GET /tenants`)
- ✅ テナント詳細取得 (`GET /tenants/{id}`)
- ✅ テナント更新 (`PUT /tenants/{id}`)

### 4. 従業員管理
- ✅ 従業員一覧取得 (`GET /employees`)
- ✅ 従業員詳細取得 (`GET /employees/{id}`)
- ✅ 従業員作成 (`POST /employees`)
- ✅ 従業員更新 (`PUT /employees/{id}`)
- ✅ 従業員削除（論理削除）(`DELETE /employees/{id}`)

### 5. 部署管理
- ✅ 部署一覧取得 (`GET /departments`)
- ✅ 部署詳細取得 (`GET /departments/{id}`)
- ✅ 部署作成 (`POST /departments`)
- ✅ 部署更新 (`PUT /departments/{id}`)
- ✅ 部署削除（論理削除）(`DELETE /departments/{id}`)

### 6. フロントエンド（HTML構造のみ）
- ✅ ログインページ（API連携済み）
- ✅ 会員登録ページ（API連携済み）
- ✅ パスワードリセットページ（API連携済み）
- ✅ ダッシュボード（HTML構造のみ、API連携なし）
- ✅ 16ページのHTML構造

---

## ❌ 未実装機能（仕様書に定義）

### 1. 打刻機能（5.4）

#### 1.1 打刻API
- ❌ `POST /punches` - 打刻記録作成
  - 打刻種類（出勤/退勤/休憩開始/休憩終了）の処理
  - 打刻検証（順序チェック、重複チェック、未来日時チェック）
  - 冪等性保証（同一従業員・同一種類・同一時刻の重複防止）
  - オフライン対応（一時保存、再送キュー）

#### 1.2 代理打刻API
- ❌ `POST /punches/proxy` - 代理打刻
  - 権限チェック（CompanyAdmin、Manager、Professional）
  - 代理打刻理由の必須入力
  - 監査ログ記録（代理打刻者、理由、日時）
  - 制限（未来日時不可、過去30日以内のみ）

#### 1.3 打刻一覧取得
- ❌ `GET /punches` - 打刻記録一覧
  - クエリパラメータ: `employee_id`, `from`, `to`, `type`
  - ページング対応
  - フィルタリング（従業員、日付範囲、種類）

#### 1.4 打刻検証ロジック
- ❌ 打刻順序の検証（出勤→退勤、休憩開始→休憩終了）
- ❌ 重複打刻の検証
- ❌ 未来日時の打刻不可
- ❌ 異常検知（未打刻、順序エラー）

#### 1.5 コントローラー
- ❌ `PunchController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 2. 勤務セッション・タイムシート（5.4, 5.6）

#### 2.1 勤務セッション生成
- ❌ 打刻記録から勤務セッション（WorkSession）の自動生成
  - 出勤から退勤までの1日の勤務単位
  - 休憩時間の計算
  - 実働時間の計算
  - 異常情報の記録（未打刻、順序エラー等）

#### 2.2 タイムシート集計
- ❌ 日次集計
  - 所定労働時間の算出
  - 実働時間の算出
  - 休憩時間の算出
  - 残業時間の算出
  - 深夜労働時間の算出
  - 休日労働時間の算出

- ❌ 週次集計
  - 週単位での集計
  - 週の開始日・終了日の設定

- ❌ 月次集計
  - 月単位での集計
  - 締日の設定

#### 2.3 タイムシートAPI
- ❌ `GET /timesheets` - タイムシート一覧取得
  - クエリパラメータ: `employee_id`, `period_from`, `period_to`, `status`
  - ページング対応

- ❌ `GET /timesheets/{id}` - タイムシート詳細取得

- ❌ `POST /timesheets/{id}/submit` - タイムシート申請
  - 状態を `draft` → `submitted` に変更
  - 申請日時の記録

- ❌ `POST /timesheets/{id}/approve` - タイムシート承認
  - 状態を `submitted` → `approved` に変更
  - 承認者・承認日時の記録
  - 承認コメント（任意）

- ❌ `POST /timesheets/{id}/reject` - タイムシート差戻し
  - 状態を `submitted` → `rejected` に変更
  - 差戻し理由の必須入力
  - 申請者への通知

#### 2.4 タイムシート承認フロー
- ❌ 承認フロー定義（`approval_flows` テーブル）
- ❌ 1〜2段階承認の実装
- ❌ 承認者判定（直属上司、CompanyAdmin）
- ❌ 承認履歴の記録

#### 2.5 コントローラー
- ❌ `TimesheetController` クラスの作成
- ❌ `WorkSessionController` クラスの作成（必要に応じて）
- ❌ `api.php` へのルーティング追加

---

### 3. 申請・承認機能（5.4）

#### 3.1 申請API
- ❌ `POST /requests` - 申請作成
  - 申請種類（修正申請、残業申請、休暇申請、その他）
  - 対象日の指定
  - 申請内容（JSON形式）
  - 申請理由（必須）
  - 添付ファイル（最大10MB、5ファイルまで、PDF/画像）

- ❌ `GET /requests` - 申請一覧取得
  - クエリパラメータ: `employee_id`, `status`, `type`, `target_date`
  - ページング対応
  - フィルタリング

- ❌ `GET /requests/{id}` - 申請詳細取得

- ❌ `PUT /requests/{id}` - 申請更新（申請中のみ）

- ❌ `DELETE /requests/{id}` - 申請削除（申請中のみ）

#### 3.2 申請承認API
- ❌ `POST /requests/{id}/approve` - 申請承認
  - 状態を `pending` → `approved` に変更
  - 承認者・承認日時の記録
  - 承認コメント（任意）
  - 申請者への通知

- ❌ `POST /requests/{id}/reject` - 申請差戻し
  - 状態を `pending` → `rejected` に変更
  - 差戻し理由の必須入力
  - 申請者への通知

#### 3.3 承認フロー
- ❌ 承認フロー定義（`approval_flows` テーブル）
- ❌ 1〜2段階承認の実装
- ❌ 承認者判定
- ❌ 承認履歴の記録

#### 3.4 ファイルアップロード
- ❌ `POST /requests/{id}/attachments` - 申請への添付ファイル追加
- ❌ ファイルストレージへの保存
- ❌ ファイルサイズ・形式の検証

#### 3.5 コントローラー
- ❌ `RequestController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 4. 就業ルール管理（5.3）

#### 4.1 営業時間設定
- ❌ `GET /business-hours` - 営業時間一覧取得
  - スコープタイプ（company, dept, employee）での取得
  - 曜日別の設定

- ❌ `POST /business-hours` - 営業時間作成
  - スコープタイプ・スコープIDの指定
  - 曜日、開始時刻、終了時刻の設定
  - 休憩ポリシーID（将来拡張用）

- ❌ `PUT /business-hours/{id}` - 営業時間更新

- ❌ `DELETE /business-hours/{id}` - 営業時間削除

#### 4.2 就業ルールセット
- ❌ `GET /rulesets` - 就業ルールセット一覧取得
  - バージョン管理
  - 適用期間（effective_from, effective_to）

- ❌ `POST /rulesets` - 就業ルールセット作成
  - ルール名、バージョン
  - 適用期間
  - ルール設定（JSON形式）
    - 丸め設定（5/10/15分等、開始/終了/合算別）
    - 残業計算式
    - 深夜労働の定義
    - 休日労働の定義

- ❌ `PUT /rulesets/{id}` - 就業ルールセット更新

- ❌ `DELETE /rulesets/{id}` - 就業ルールセット削除

#### 4.3 祝日カレンダー
- ❌ `GET /holiday-calendars` - 祝日カレンダー一覧取得
  - スコープタイプ（country, company, dept, employee）での取得
  - 日付範囲でのフィルタリング

- ❌ `POST /holiday-calendars` - 祝日カレンダー作成
  - スコープタイプ・スコープIDの指定
  - 日付、名称、種類（holiday, company_holiday, special）

- ❌ `PUT /holiday-calendars/{id}` - 祝日カレンダー更新

- ❌ `DELETE /holiday-calendars/{id}` - 祝日カレンダー削除

#### 4.4 ルール計算エンジン
- ❌ ルール適用ロジック
  - 優先度（個人 > 部署 > 会社）
  - バージョン・適用期間の解決
  - 丸め計算
  - 残業時間計算
  - 深夜労働時間計算
  - 休日労働時間計算

#### 4.5 コントローラー
- ❌ `BusinessHoursController` クラスの作成
- ❌ `RuleSetController` クラスの作成
- ❌ `HolidayCalendarController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 5. CSV入出力（5.7）

#### 5.1 CSVエクスポート
- ❌ `POST /exports` - エクスポートジョブ作成
  - エクスポート種類（employees, attendance, summary, punches）
  - エクスポートパラメータ（JSON形式）
  - 非同期ジョブとして実行

- ❌ `GET /exports/{id}` - エクスポートジョブ状態取得

- ❌ `GET /exports/{id}/download` - エクスポートファイルダウンロード

- ❌ エクスポート実装
  - 従業員一覧エクスポート
  - 勤怠明細エクスポート
  - 集計結果エクスポート
  - 打刻原票エクスポート

#### 5.2 CSVインポート
- ❌ `POST /imports` - インポートジョブ作成
  - インポート種類（employees, punches）
  - ファイルアップロード
  - 非同期ジョブとして実行

- ❌ `GET /imports/{id}` - インポートジョブ状態取得

- ❌ `POST /imports/{id}/retry` - インポートジョブ再実行

- ❌ インポート実装
  - 従業員基本情報インポート
  - 打刻履歴インポート
  - バリデーション（重複チェック、形式チェック）
  - エラー行の報告

#### 5.3 ジョブ管理
- ❌ `GET /jobs/{id}` - ジョブ状態取得（共通）
- ❌ ジョブ状態管理（pending → processing → completed/failed）
- ❌ 結果通知（メール/アプリ内通知）
- ❌ 再実行機能（最大3回まで）

#### 5.4 コントローラー
- ❌ `ExportController` クラスの作成
- ❌ `ImportController` クラスの作成
- ❌ `JobController` クラスの作成（必要に応じて）
- ❌ `api.php` へのルーティング追加

---

### 6. ガントチャート（5.5）

#### 6.1 ガントチャートデータ取得API
- ❌ `GET /gantt` - ガントチャートデータ取得
  - クエリパラメータ: `employee_id`, `dept_id`, `from`, `to`, `scale` (day/week/month)
  - フィルタリング（部署、雇用区分、在籍、ステータス、日付範囲）

- ❌ データ形式
  - 出退勤バー
  - 休憩バー
  - 申請中/確定状態
  - アラート表示（遅刻/早退/未打刻）

#### 6.2 フロントエンド実装
- ❌ ガントチャート表示（`pages/gantt.html`）
  - 時間軸（0-24h、日/週/月）
  - バー種別（勤務、休憩、申請中、異常）
  - インタラクション（ホバー詳細、クリック編集、ズーム、パン）
  - アクセシビリティ対応

#### 6.3 コントローラー
- ❌ `GanttController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 7. 通知機能（5.8）

#### 7.1 通知API
- ❌ `GET /notifications` - 通知一覧取得
  - クエリパラメータ: `unread_only`, `type`, `channel`
  - ページング対応

- ❌ `PUT /notifications/{id}/read` - 通知を既読にする

- ❌ `PUT /notifications/settings` - 通知設定更新
  - ユーザー単位で通知チャネル・タイプをON/OFF設定

#### 7.2 通知タイプ
- ❌ 申請/承認/差戻し通知（即時配信）
- ❌ 未打刻リマインド（打刻時刻から30分後、1日1回まで）
- ❌ 未申請リマインド（締日3日前、1日1回まで）
- ❌ 締日前リマインド（締日1日前、当日）
- ❌ 休日出勤検知（打刻時に即時通知）

#### 7.3 通知チャネル
- ❌ メール送信機能
  - SMTP設定
  - メールテンプレート（多言語対応：日本語、英語）
  - カスタマイズ可能

- ❌ アプリ内通知
  - 通知一覧表示
  - 未読数表示
  - 既読管理

#### 7.4 通知スケジューラー
- ❌ バッチ処理によるリマインド送信
- ❌ レート制限（1日1回まで等）

#### 7.5 コントローラー
- ❌ `NotificationController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 8. レポート・ダッシュボード（5.6）

#### 8.1 ダッシュボードKPI計算
- ❌ 今日の出勤者数
- ❌ 未打刻者数
- ❌ 承認待ち申請数
- ❌ 今月の平均労働時間
- ❌ 遅刻率
- ❌ 未打刻率
- ❌ 所定乖離率

#### 8.2 ダッシュボードAPI
- ❌ `GET /dashboard/stats` - ダッシュボード統計情報取得
  - 今日の打刻状況
  - 承認待ち申請一覧
  - KPI値

#### 8.3 レポートAPI
- ❌ `GET /reports/summary` - 集計レポート取得
  - 日/週/月次での集計
  - 部署別、従業員別の集計

#### 8.4 フロントエンド実装
- ❌ ダッシュボード（`dashboard.html`）のAPI連携
  - 統計カードのデータ取得
  - 今日の打刻状況テーブルのデータ取得
  - 承認待ち申請テーブルのデータ取得

- ❌ レポートページ（`pages/reports.html`）のAPI連携

#### 8.5 コントローラー
- ❌ `DashboardController` クラスの作成
- ❌ `ReportController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 9. ファイル管理（18.5）

#### 9.1 ファイルアップロード
- ❌ `POST /files/upload` - ファイルアップロード
  - ファイル種類（tenant_logo, request_attachment, other）
  - ファイルサイズ・形式の検証
  - ストレージへの保存（S3/Cloud Storage（本番）、ローカル（開発））

#### 9.2 ファイル取得
- ❌ `GET /files/{id}` - ファイル取得
  - 署名付きURL（一時アクセス）
  - テナント単位でのアクセス制御

#### 9.3 ファイル削除
- ❌ `DELETE /files/{id}` - ファイル削除

#### 9.4 ロゴアップロード
- ❌ `POST /tenants/{id}/logo` - テナントロゴアップロード
  - 形式: PNG、JPG、SVG（推奨サイズ: 200x200px）
  - 最大サイズ: 2MB

#### 9.5 コントローラー
- ❌ `FileController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 10. MFA（多要素認証）（5.1）

#### 10.1 MFA有効化
- ❌ `POST /auth/mfa/enable` - MFA有効化
  - TOTP秘密鍵の生成
  - QRコード生成
  - バックアップコード生成（10個）

#### 10.2 MFA検証
- ❌ `POST /auth/mfa/verify` - TOTP検証
  - 6桁コードの検証
  - バックアップコードの検証

#### 10.3 MFA無効化
- ❌ `POST /auth/mfa/disable` - MFA無効化
  - パスワード確認が必要

#### 10.4 コントローラー
- ❌ `AuthController` へのMFAメソッド追加
- ❌ `api.php` へのルーティング追加

---

### 11. 従業員招待（5.2）

#### 11.1 従業員招待API
- ❌ `POST /employees/invite` - 従業員招待
  - 招待トークン生成（UUID、32文字以上）
  - メール送信
  - 有効期限7日

#### 11.2 招待受け入れ
- ❌ `GET /invitations/{token}` - 招待トークン検証
- ❌ `POST /invitations/{token}/accept` - 招待受け入れ
  - アカウント作成
  - パスワード設定
  - 従業員プロファイルとの紐付け

#### 11.3 コントローラー
- ❌ `EmployeeController` への招待メソッド追加
- ❌ `InvitationController` クラスの作成（必要に応じて）
- ❌ `api.php` へのルーティング追加

---

### 12. セッション管理（5.1）

#### 12.1 セッション一覧取得
- ❌ `GET /auth/sessions` - セッション一覧取得
  - 現在のユーザーの全セッション
  - デバイス情報、IPアドレス、最終アクセス時刻

#### 12.2 セッション削除
- ❌ `DELETE /auth/sessions/{id}` - セッション削除
  - 特定セッションの無効化
  - 管理者による強制ログアウト

#### 12.3 同時ログイン制限
- ❌ 設定による同時ログイン制限
- ❌ 古いセッションの自動無効化

#### 12.4 コントローラー
- ❌ `AuthController` へのセッション管理メソッド追加
- ❌ `api.php` へのルーティング追加

---

### 13. 監査ログ（5.9）

#### 13.1 監査ログ取得API
- ❌ `GET /audit-logs` - 監査ログ一覧取得
  - クエリパラメータ: `actor_user_id`, `action`, `entity`, `entity_id`, `from`, `to`
  - ページング対応
  - フィルタリング

#### 13.2 監査ログエクスポート
- ❌ `POST /audit-logs/export` - 監査ログエクスポート
  - CSV形式でのエクスポート

#### 13.3 フロントエンド実装
- ❌ 監査ログページ（`pages/audit-logs.html`）のAPI連携
  - 監査ログ一覧表示
  - フィルタリング機能
  - エクスポート機能

#### 13.4 コントローラー
- ❌ `AuditLogController` クラスの作成
- ❌ `api.php` へのルーティング追加

---

### 14. フロントエンドのAPI連携

#### 14.1 ダッシュボード
- ❌ `dashboard.html` のAPI連携
  - 統計カードのデータ取得
  - 今日の打刻状況テーブル
  - 承認待ち申請テーブル

#### 14.2 打刻ページ
- ❌ `pages/punch.html` のAPI連携
  - 打刻ボタンの実装
  - 打刻履歴の表示
  - 代理打刻機能

#### 14.3 従業員管理ページ
- ❌ `pages/employees.html` のAPI連携
  - 従業員一覧の取得・表示
  - 従業員作成・更新・削除
  - ページング・フィルタリング

#### 14.4 部署管理ページ
- ❌ `pages/departments.html` のAPI連携
  - 部署一覧の取得・表示
  - 部署作成・更新・削除
  - 階層構造の表示

#### 14.5 申請・承認ページ
- ❌ `pages/requests.html` のAPI連携
  - 申請一覧の取得・表示
  - 申請作成
  - 申請承認・差戻し

#### 14.6 承認ページ
- ❌ `pages/approvals.html` のAPI連携
  - 承認待ち申請一覧
  - 承認・差戻し処理

#### 14.7 ガントチャートページ
- ❌ `pages/gantt.html` のAPI連携
  - ガントチャートデータの取得・表示
  - インタラクション機能

#### 14.8 レポートページ
- ❌ `pages/reports.html` のAPI連携
  - 集計レポートの取得・表示
  - エクスポート機能

#### 14.9 企業設定ページ
- ❌ `pages/company-settings.html` のAPI連携
  - テナント情報の取得・更新
  - 営業時間設定
  - 就業ルール設定
  - 祝日カレンダー設定
  - ロゴアップロード

#### 14.10 プロフィールページ
- ❌ `pages/profile.html` のAPI連携
  - ユーザー情報の取得・更新
  - パスワード変更
  - MFA設定

#### 14.11 その他のページ
- ❌ `pages/employee-detail.html` のAPI連携
- ❌ `pages/employee-invite.html` のAPI連携
- ❌ `pages/punch-proxy.html` のAPI連携
- ❌ `pages/timesheet-detail.html` のAPI連携
- ❌ `pages/payslip.html` のAPI連携（将来機能）

---

### 15. 共通機能

#### 15.1 エラーハンドリング
- ❌ フロントエンドでの統一されたエラーハンドリング
- ❌ エラーメッセージの表示

#### 15.2 ローディング表示
- ❌ API呼び出し中のローディング表示

#### 15.3 認証状態の管理
- ❌ セッション切れ時の自動ログアウト
- ❌ 認証が必要なページへのアクセス制御

#### 15.4 共通JavaScript関数
- ❌ API呼び出しの共通関数
- ❌ エラーハンドリングの共通関数
- ❌ 認証チェックの共通関数

---

## 📊 実装状況サマリー

### 実装済み
- データベース設計: 100%
- 認証・認可: 100%（MFA除く）
- テナント管理: 100%
- 従業員管理: 100%（招待除く）
- 部署管理: 100%
- フロントエンド（HTML構造）: 100%
- フロントエンド（API連携）: 約10%（ログイン、会員登録、パスワードリセットのみ）

### 未実装
- 打刻機能: 0%
- 勤務セッション・タイムシート: 0%
- 申請・承認機能: 0%
- 就業ルール管理: 0%
- CSV入出力: 0%
- ガントチャート: 0%
- 通知機能: 0%
- レポート・ダッシュボード（データ連携）: 0%
- ファイル管理: 0%
- MFA: 0%
- 従業員招待: 0%
- セッション管理（詳細）: 0%
- 監査ログ（API・フロントエンド）: 0%

---

## 🎯 推奨実装順序

### Phase 1: コア機能（最優先）
1. **打刻機能**
   - 打刻API実装
   - 打刻検証ロジック
   - 打刻一覧取得
   - フロントエンド連携

2. **勤務セッション生成**
   - 打刻記録から勤務セッション生成
   - 異常検知

3. **ダッシュボードのデータ連携**
   - ダッシュボードAPI実装
   - フロントエンド連携

### Phase 2: 申請・承認（高優先度）
4. **申請機能**
   - 申請作成・一覧・承認・差戻し
   - フロントエンド連携

5. **タイムシート集計・承認**
   - 日/週/月次集計
   - タイムシート承認フロー
   - フロントエンド連携

### Phase 3: その他機能（中優先度）
6. **就業ルール管理**
7. **ガントチャート**
8. **CSV入出力**
9. **通知機能**
10. **レポート・ダッシュボード（詳細）**

### Phase 4: 拡張機能（低優先度）
11. **ファイル管理**
12. **MFA**
13. **従業員招待**
14. **セッション管理（詳細）**
15. **監査ログ（API・フロントエンド）**

---

最終更新: 2025-01-26

