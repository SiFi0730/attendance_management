<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¾“æ¥­å“¡è©³ç´° - å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="../styles/common.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/layout.css">
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <a href="../dashboard.html" class="header-logo">å‹¤æ€ ç®¡ç†</a>
        <nav class="header-nav">
          <a href="../dashboard.html" class="header-nav-link">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
          <a href="punch.html" class="header-nav-link">æ‰“åˆ»</a>
          <a href="gantt.html" class="header-nav-link">ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</a>
          <a href="reports.html" class="header-nav-link">ãƒ¬ãƒãƒ¼ãƒˆ</a>
        </nav>
      </div>
      <div class="header-right">
        <a href="requests.html" class="header-nav-link">ç”³è«‹</a>
        <button onclick="logout()" class="btn btn-sm btn-secondary" style="margin-right: var(--spacing-sm);">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        <a href="profile.html" class="header-user" style="text-decoration: none;">
          <div class="header-user-avatar"></div>
          <span class="header-user-name"></span>
        </a>
      </div>
    </div>
  </header>

  <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
  <aside class="sidebar">
    <ul class="sidebar-menu">
      <li class="sidebar-menu-item">
        <a href="../dashboard.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ“Š</span>
          <span class="sidebar-menu-label">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="punch.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">â°</span>
          <span class="sidebar-menu-label">æ‰“åˆ»</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="gantt.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ“…</span>
          <span class="sidebar-menu-label">ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆ</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="requests.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ“</span>
          <span class="sidebar-menu-label">ç”³è«‹ãƒ»æ‰¿èª</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="employees.html" class="sidebar-menu-link active">
          <span class="sidebar-menu-icon">ğŸ‘¥</span>
          <span class="sidebar-menu-label">å¾“æ¥­å“¡ç®¡ç†</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="company-settings.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">âš™ï¸</span>
          <span class="sidebar-menu-label">ä¼æ¥­è¨­å®š</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="reports.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ“ˆ</span>
          <span class="sidebar-menu-label">ãƒ¬ãƒãƒ¼ãƒˆ</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="payslip.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ’°</span>
          <span class="sidebar-menu-label">çµ¦ä¸æ˜ç´°</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="audit-logs.html" class="sidebar-menu-link">
          <span class="sidebar-menu-icon">ğŸ”</span>
          <span class="sidebar-menu-label">ç›£æŸ»ãƒ­ã‚°</span>
        </a>
      </li>
    </ul>
  </aside>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="main-content">
    <div class="breadcrumb">
      <span class="breadcrumb-item"><a href="employees.html">å¾“æ¥­å“¡ç®¡ç†</a></span>
      <span class="breadcrumb-item active">å¾“æ¥­å“¡è©³ç´°</span>
    </div>

    <div class="page-header">
      <h1 class="page-title">å¾“æ¥­å“¡è©³ç´°</h1>
      <div class="page-actions">
        <button class="btn btn-secondary">ç·¨é›†</button>
        <button class="btn btn-danger">å‰Šé™¤</button>
      </div>
    </div>

    <div class="grid grid-cols-2" style="margin-bottom: var(--spacing-xl);">
      <!-- åŸºæœ¬æƒ…å ± -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">åŸºæœ¬æƒ…å ±</h2>
        </div>
        <div class="card-body">
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ç¤¾å“¡ç•ªå·:</div>
            <div>EMP001</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">æ°å:</div>
            <div>å±±ç”°å¤ªéƒ</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ãƒ¡ãƒ¼ãƒ«:</div>
            <div>yamada@example.com</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">éƒ¨ç½²:</div>
            <div>å–¶æ¥­éƒ¨</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">é›‡ç”¨å½¢æ…‹:</div>
            <div>æ­£ç¤¾å“¡</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">é›‡ç”¨æ—¥:</div>
            <div>2020-04-01</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</div>
            <div><span class="badge badge-success">åœ¨ç±</span></div>
          </div>
        </div>
      </div>

      <!-- æ¨©é™æƒ…å ± -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">æ¨©é™æƒ…å ±</h2>
        </div>
        <div class="card-body">
          <div style="margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">å½¹å‰²:</div>
            <div><span class="badge badge-primary">Employee</span></div>
          </div>
          <div style="margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">æ¨©é™ç¯„å›²:</div>
            <div style="font-size: var(--font-size-sm); color: var(--text-secondary);">
              - è‡ªåˆ†ã®æ‰“åˆ»ãƒ»ç”³è«‹ãƒ»é–²è¦§
            </div>
          </div>
          <div>
            <div style="font-weight: 600; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³:</div>
            <div>2025-01-15 09:00</div>
          </div>
        </div>
      </div>
    </div>

    <!-- å‹¤æ€ çµ±è¨ˆ -->
    <div class="card">
      <div class="card-header">
        <h2 class="card-title">ä»Šæœˆã®å‹¤æ€ çµ±è¨ˆ</h2>
      </div>
      <div class="card-body">
        <div class="grid grid-cols-4">
          <div class="stats-card">
            <div class="stats-card-label">å®Ÿåƒæ™‚é–“</div>
            <div class="stats-card-value">162.5h</div>
          </div>
          <div class="stats-card">
            <div class="stats-card-label">æ®‹æ¥­æ™‚é–“</div>
            <div class="stats-card-value">12.5h</div>
          </div>
          <div class="stats-card">
            <div class="stats-card-label">é…åˆ»å›æ•°</div>
            <div class="stats-card-value">1å›</div>
          </div>
          <div class="stats-card">
            <div class="stats-card-label">æ—©é€€å›æ•°</div>
            <div class="stats-card-value">0å›</div>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="../scripts/common.js"></script>
  <script>
    // ============================================
    // å¾“æ¥­å“¡è©³ç´° - APIé€£æº
    // ============================================

    let employee = null;
    let employeeId = null;

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', async function() {
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰IDã‚’å–å¾—
      const urlParams = new URLSearchParams(window.location.search);
      employeeId = urlParams.get('id');
      
      if (!employeeId) {
        alert('å¾“æ¥­å“¡IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
        window.location.href = 'employees.html';
        return;
      }

      await loadEmployee();
      setupEventListeners();
      updateHeaderUserInfo();
    });

    // å¾“æ¥­å“¡è©³ç´°ã‚’èª­ã¿è¾¼ã¿
    async function loadEmployee() {
      try {
        const response = await apiFetch(`${API_BASE_URL}/employees/${employeeId}`);
        const data = await response.json();
        
        if (response.ok && data.success) {
          employee = data.data;
          renderEmployee();
        } else {
          console.error('å¾“æ¥­å“¡è©³ç´°å–å¾—ã‚¨ãƒ©ãƒ¼:', data);
          alert('å¾“æ¥­å“¡æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
          window.location.href = 'employees.html';
        }
      } catch (error) {
        console.error('å¾“æ¥­å“¡è©³ç´°ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
        alert('å¾“æ¥­å“¡æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
        window.location.href = 'employees.html';
      }
    }

    // å¾“æ¥­å“¡æƒ…å ±ã‚’æç”»
    function renderEmployee() {
      if (!employee) return;

      const employmentTypeLabels = {
        'full_time': 'æ­£ç¤¾å“¡',
        'part_time': 'ãƒ‘ãƒ¼ãƒˆ',
        'contract': 'å¥‘ç´„ç¤¾å“¡'
      };

      const statusBadges = {
        'active': '<span class="badge badge-success">åœ¨ç±</span>',
        'on_leave': '<span class="badge badge-warning">ä¼‘è·ä¸­</span>',
        'retired': '<span class="badge badge-error">é€€è·</span>'
      };

      const hireDate = employee.hire_date ? new Date(employee.hire_date).toLocaleDateString('ja-JP') : '-';
      const leaveDate = employee.leave_date ? new Date(employee.leave_date).toLocaleDateString('ja-JP') : '-';

      // åŸºæœ¬æƒ…å ±ã‚’æ›´æ–°
      const basicInfo = document.querySelector('.card-body');
      if (basicInfo) {
        basicInfo.innerHTML = `
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ç¤¾å“¡ç•ªå·:</div>
            <div>${employee.employee_code || '-'}</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">æ°å:</div>
            <div>${employee.name || '-'}</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ãƒ¡ãƒ¼ãƒ«:</div>
            <div>${employee.email || '-'}</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">éƒ¨ç½²:</div>
            <div>${employee.department_name || '-'}</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">é›‡ç”¨å½¢æ…‹:</div>
            <div>${employmentTypeLabels[employee.employment_type] || employee.employment_type || '-'}</div>
          </div>
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">é›‡ç”¨æ—¥:</div>
            <div>${hireDate}</div>
          </div>
          ${leaveDate !== '-' ? `
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md); margin-bottom: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">é€€è·æ—¥:</div>
            <div>${leaveDate}</div>
          </div>
          ` : ''}
          <div style="display: grid; grid-template-columns: 120px 1fr; gap: var(--spacing-md);">
            <div style="font-weight: 600; color: var(--text-secondary);">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</div>
            <div>${statusBadges[employee.status] || employee.status || '-'}</div>
          </div>
        `;
      }
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    function setupEventListeners() {
      // ç·¨é›†ãƒœã‚¿ãƒ³
      const editButton = document.querySelector('.page-actions .btn-secondary');
      if (editButton) {
        editButton.addEventListener('click', function() {
          window.location.href = `employees.html?edit=${employeeId}`;
        });
      }

      // å‰Šé™¤ãƒœã‚¿ãƒ³
      const deleteButton = document.querySelector('.page-actions .btn-danger');
      if (deleteButton) {
        deleteButton.addEventListener('click', async function() {
          if (!confirm('ã“ã®å¾“æ¥­å“¡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
            return;
          }

          try {
            const response = await apiFetch(`${API_BASE_URL}/employees/${employeeId}`, {
              method: 'DELETE'
            });
            const data = await response.json();

            if (response.ok && data.success) {
              alert('å¾“æ¥­å“¡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
              window.location.href = 'employees.html';
            } else {
              console.error('å¾“æ¥­å“¡å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', data);
              alert('å¾“æ¥­å“¡ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (data.error?.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
            }
          } catch (error) {
            console.error('å¾“æ¥­å“¡å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            alert('å¾“æ¥­å“¡ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
          }
        });
      }
    }
  </script>
</body>
</html>

